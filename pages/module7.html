<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥dulo 7: Proyectos Capstone - Code Agent Arena</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/games.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="logo">
                <h1>ü§ñ Code Agent Arena</h1>
            </div>
            <ul class="nav-links">
                <li><a href="../index.html">‚Üê Inicio</a></li>
                <li><a href="#teoria">Introducci√≥n</a></li>
                <li><a href="#proyectos">Proyectos</a></li>
                <li><a href="#certificado">Certificado</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="module-header">
            <h1>M√≥dulo 7: Proyectos Capstone</h1>
            <p class="module-subtitle">Construye 3 Agentes Completos Aplicando Todo lo Aprendido</p>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-btn active" data-tab="intro">üìö Introducci√≥n</button>
                <button class="tab-btn" data-tab="proyecto1">ü§ñ Proyecto 1</button>
                <button class="tab-btn" data-tab="proyecto2">üìä Proyecto 2</button>
                <button class="tab-btn" data-tab="proyecto3">üîç Proyecto 3</button>
                <button class="tab-btn" data-tab="certificado">üéì Certificado</button>
            </div>
        </div>

        <!-- Tab Content: Introducci√≥n -->
        <section id="intro" class="tab-content active theory-section">
            <h2>üéì ¬°Llegaste al Final del Viaje!</h2>
            
            <div class="theory-card">
                <h3>¬øQu√© es un Proyecto Capstone?</h3>
                <p>Un proyecto capstone es un proyecto final integrador donde aplicas todos los conceptos aprendidos para construir algo real y funcional.</p>
                
                <div class="capstone-overview">
                    <div class="overview-item">
                        <div class="overview-icon">‚úÖ</div>
                        <div class="overview-content">
                            <h4>Integraci√≥n Completa</h4>
                            <p>Usar√°s arquitecturas (ReAct, CoT), memoria (vector DBs), herramientas, y evaluaci√≥n en un solo proyecto.</p>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-icon">üõ†Ô∏è</div>
                        <div class="overview-content">
                            <h4>Implementaci√≥n Real</h4>
                            <p>No son ejercicios te√≥ricos. Son proyectos que puedes usar en tu portafolio o adaptar para casos reales.</p>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-icon">üìö</div>
                        <div class="overview-content">
                            <h4>Gu√≠a Paso a Paso</h4>
                            <p>Cada proyecto incluye: especificaciones, pseudoc√≥digo, decisiones de dise√±o, y recursos para implementar.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="theory-card">
                <h3>üìã Los 3 Proyectos</h3>
                <p>Elegimos estos proyectos porque representan casos de uso comunes y valiosos en la industria:</p>
                
                <div class="projects-preview">
                    <div class="project-preview-card">
                        <div class="project-icon">ü§ñ</div>
                        <h4>Proyecto 1: Agente de FAQ Inteligente</h4>
                        <p class="project-difficulty">Dificultad: üü¢ Intermedia</p>
                        <p>Un agente de soporte que responde preguntas frecuentes usando RAG con una base de conocimiento. Incluye fallback a humano cuando no est√° seguro.</p>
                        <div class="project-tech">
                            <span class="tech-badge">ReAct</span>
                            <span class="tech-badge">Vector DB</span>
                            <span class="tech-badge">RAG</span>
                            <span class="tech-badge">Evaluation</span>
                        </div>
                    </div>

                    <div class="project-preview-card">
                        <div class="project-icon">üìä</div>
                        <h4>Proyecto 2: Agente de An√°lisis de Datos</h4>
                        <p class="project-difficulty">Dificultad: üü° Intermedia-Avanzada</p>
                        <p>Un agente que carga CSVs, ejecuta an√°lisis con Python (pandas), genera gr√°ficos, y responde preguntas sobre los datos en lenguaje natural.</p>
                        <div class="project-tech">
                            <span class="tech-badge">Code Interpreter</span>
                            <span class="tech-badge">Plan-and-Execute</span>
                            <span class="tech-badge">Sandboxing</span>
                            <span class="tech-badge">Data Viz</span>
                        </div>
                    </div>

                    <div class="project-preview-card">
                        <div class="project-icon">üîç</div>
                        <h4>Proyecto 3: Agente de Investigaci√≥n Multi-Fuente</h4>
                        <p class="project-difficulty">Dificultad: üî¥ Avanzada</p>
                        <p>Un agente que busca informaci√≥n en m√∫ltiples fuentes (web, papers, APIs), sintetiza hallazgos, y genera un reporte estructurado con citas verificables.</p>
                        <div class="project-tech">
                            <span class="tech-badge">Multi-Agente</span>
                            <span class="tech-badge">Web Search</span>
                            <span class="tech-badge">RAG</span>
                            <span class="tech-badge">Fact-Checking</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="theory-card">
                <h3>üéØ Objetivos de Aprendizaje</h3>
                <p>Al completar estos proyectos, ser√°s capaz de:</p>
                <ul class="learning-objectives">
                    <li>‚úÖ Dise√±ar arquitecturas de agentes apropiadas para cada problema</li>
                    <li>‚úÖ Integrar LLMs con herramientas externas (APIs, c√≥digo, bases de datos)</li>
                    <li>‚úÖ Implementar sistemas de memoria (RAG, vector DBs)</li>
                    <li>‚úÖ Evaluar y optimizar agentes con m√©tricas objetivas</li>
                    <li>‚úÖ Manejar casos edge y errores gracefully</li>
                    <li>‚úÖ Aplicar best practices de seguridad y alineaci√≥n</li>
                    <li>‚úÖ Documentar decisiones de dise√±o y trade-offs</li>
                </ul>
            </div>

            <div class="theory-card">
                <h3>üõ†Ô∏è Stack Tecnol√≥gico Recomendado</h3>
                <p>Estos proyectos pueden implementarse con diferentes stacks. Aqu√≠ est√° la recomendaci√≥n para principiantes:</p>
                
                <div class="tech-stack">
                    <div class="stack-category">
                        <h4>Lenguaje</h4>
                        <div class="stack-option recommended">
                            <strong>Python 3.10+</strong>
                            <p>Mejor ecosistema para IA, muchas librer√≠as</p>
                        </div>
                    </div>

                    <div class="stack-category">
                        <h4>Framework de Agentes</h4>
                        <div class="stack-option recommended">
                            <strong>LangChain / LangGraph</strong>
                            <p>Abstracci√≥n alta, muchos ejemplos, comunidad activa</p>
                        </div>
                        <div class="stack-option alternative">
                            <strong>Vanilla (sin framework)</strong>
                            <p>Control total, entiendes cada detalle</p>
                        </div>
                    </div>

                    <div class="stack-category">
                        <h4>LLM Provider</h4>
                        <div class="stack-option recommended">
                            <strong>OpenAI GPT-4o-mini</strong>
                            <p>Balance perfecto: barato ($0.15/1M tokens), r√°pido, buen razonamiento</p>
                        </div>
                        <div class="stack-option alternative">
                            <strong>Anthropic Claude 3.5 Haiku</strong>
                            <p>Excelente en c√≥digo y an√°lisis, similar precio</p>
                        </div>
                    </div>

                    <div class="stack-category">
                        <h4>Vector Database</h4>
                        <div class="stack-option recommended">
                            <strong>Chroma</strong>
                            <p>In-memory, f√°cil setup, gratis, perfecto para prototipos</p>
                        </div>
                        <div class="stack-option alternative">
                            <strong>Pinecone</strong>
                            <p>Hosted, escalable, 100K vectores gratis</p>
                        </div>
                    </div>

                    <div class="stack-category">
                        <h4>Evaluaci√≥n</h4>
                        <div class="stack-option recommended">
                            <strong>LangSmith</strong>
                            <p>Tracking, debugging, datasets de test, LLM-as-judge</p>
                        </div>
                    </div>

                    <div class="stack-category">
                        <h4>Deployment (Opcional)</h4>
                        <div class="stack-option recommended">
                            <strong>Streamlit</strong>
                            <p>UI en Python, deploy gratis en Streamlit Cloud</p>
                        </div>
                        <div class="stack-option alternative">
                            <strong>Gradio</strong>
                            <p>M√°s flexible, tambi√©n deploy gratis en Hugging Face Spaces</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab Content: Proyecto 1 -->
        <section id="proyecto1" class="tab-content projects-section">
            <h2>ü§ñ Proyecto 1: Agente de FAQ Inteligente con RAG</h2>

            <div class="project-card">
                <div class="project-header">
                    <div class="project-number">Proyecto 1</div>
                    <h3>ü§ñ Agente de FAQ Inteligente con RAG</h3>
                    <div class="project-meta">
                        <span class="difficulty intermediate">Intermedia</span>
                        <span class="time">‚è±Ô∏è 4-6 horas</span>
                    </div>
                </div>

                <div class="project-content">
                    <div class="project-description">
                        <h4>üìã Descripci√≥n del Problema</h4>
                        <p>Una empresa de software tiene 200+ preguntas frecuentes en su base de conocimiento (markdown files). Los clientes preguntan cosas como:</p>
                        <ul>
                            <li>"¬øC√≥mo reseteo mi contrase√±a?"</li>
                            <li>"¬øCu√°l es el precio del plan Enterprise?"</li>
                            <li>"¬øIntegraciones con Salesforce?"</li>
                        </ul>
                        <p>El agente debe:</p>
                        <ol>
                            <li>Buscar en la base de conocimiento (RAG)</li>
                            <li>Responder con informaci√≥n precisa y citando fuentes</li>
                            <li>Si no encuentra respuesta con confianza > 0.7 ‚Üí escalar a humano</li>
                            <li>Tracking de queries para identificar gaps en documentaci√≥n</li>
                        </ol>
                    </div>

                    <div class="project-architecture">
                        <h4>üèóÔ∏è Arquitectura Propuesta</h4>
                        <div class="architecture-diagram">
                            <div class="arch-component">
                                <div class="arch-box">User Question</div>
                                <div class="arch-arrow">‚Üì</div>
                            </div>
                            <div class="arch-component">
                                <div class="arch-box">Embedding Model<br><small>text-embedding-3-small</small></div>
                                <div class="arch-arrow">‚Üì</div>
                            </div>
                            <div class="arch-component">
                                <div class="arch-box">Vector Search<br><small>Top 3 docs</small></div>
                                <div class="arch-arrow">‚Üì</div>
                            </div>
                            <div class="arch-component">
                                <div class="arch-box">LLM (GPT-4o-mini)<br><small>Answer based on docs</small></div>
                                <div class="arch-arrow">‚Üì</div>
                            </div>
                            <div class="arch-component decision">
                                <div class="arch-box">Confidence > 0.7?</div>
                                <div class="arch-split">
                                    <div class="arch-branch">
                                        <span class="branch-label yes">S√≠ ‚Üí</span>
                                        <div class="arch-box">Return Answer + Citation</div>
                                    </div>
                                    <div class="arch-branch">
                                        <span class="branch-label no">No ‚Üí</span>
                                        <div class="arch-box">Escalate to Human</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="project-code">
                        <h4>üíª Pseudoc√≥digo</h4>
                        <pre><code class="language-python"># 1. Cargar base de conocimiento
def load_knowledge_base(folder_path):
    docs = []
    for file in folder_path.glob("*.md"):
        content = file.read_text()
        docs.append({"content": content, "source": file.name})
    return docs

# 2. Crear vector store
def create_vector_store(docs):
    embeddings = OpenAIEmbeddings(model="text-embedding-3-small")
    texts = [doc["content"] for doc in docs]
    metadatas = [{"source": doc["source"]} for doc in docs]
    vector_store = Chroma.from_texts(texts, embeddings, metadatas=metadatas)
    return vector_store

# 3. Agente RAG
def faq_agent(question, vector_store):
    # Buscar docs relevantes
    relevant_docs = vector_store.similarity_search_with_score(question, k=3)
    
    # Si el score del mejor doc < threshold ‚Üí no conf√≠a
    if relevant_docs[0][1] < 0.7:
        return {
            "answer": "No encontr√© informaci√≥n suficiente. Te conectar√© con soporte humano.",
            "escalate": True,
            "confidence": relevant_docs[0][1]
        }
    
    # Construir contexto
    context = "\n\n".join([doc[0].page_content for doc in relevant_docs[:3]])
    sources = [doc[0].metadata["source"] for doc in relevant_docs[:3]]
    
    # Prompt
    prompt = f"""Responde la pregunta del cliente bas√°ndote SOLO en este contexto.
Si el contexto no tiene la respuesta, di que no sabes.

Contexto:
{context}

Pregunta: {question}

Respuesta (incluye fuentes):"""
    
    # LLM
    response = openai.ChatCompletion.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}],
        temperature=0
    )
    
    answer = response.choices[0].message.content
    
    return {
        "answer": answer,
        "sources": sources,
        "confidence": relevant_docs[0][1],
        "escalate": False
    }

# 4. Evaluaci√≥n
def evaluate_agent(test_cases, vector_store):
    results = []
    for question, expected_answer in test_cases:
        result = faq_agent(question, vector_store)
        # LLM-as-judge
        is_correct = llm_judge(question, result["answer"], expected_answer)
        results.append({
            "question": question,
            "correct": is_correct,
            "confidence": result["confidence"]
        })
    
    accuracy = sum(r["correct"] for r in results) / len(results)
    avg_confidence = sum(r["confidence"] for r in results) / len(results)
    
    return {"accuracy": accuracy, "avg_confidence": avg_confidence}</code></pre>
                    </div>

                    <div class="project-decisions">
                        <h4>ü§î Decisiones de Dise√±o</h4>
                        <div class="decision-item">
                            <strong>¬øPor qu√© GPT-4o-mini en vez de GPT-4?</strong>
                            <p>Para FAQs, 4o-mini es suficiente (las preguntas son directas). Es 20x m√°s barato ($0.15 vs $3/1M tokens) y 2x m√°s r√°pido.</p>
                        </div>
                        <div class="decision-item">
                            <strong>¬øPor qu√© top-3 docs en vez de top-1?</strong>
                            <p>Un solo doc puede no tener toda la info. Top-3 da contexto m√°s completo. El LLM sabe sintetizar m√∫ltiples fuentes.</p>
                        </div>
                        <div class="decision-item">
                            <strong>¬øPor qu√© threshold de 0.7 para escalar?</strong>
                            <p>Basado en experimentos: < 0.7 ‚Üí alto riesgo de hallucination. Mejor escalar que dar respuesta incorrecta.</p>
                        </div>
                    </div>

                    <div class="project-improvements">
                        <h4>üöÄ Mejoras Opcionales</h4>
                        <ul>
                            <li><strong>Reranking:</strong> Usar modelo de reranking (Cohere, jina-reranker) para ordenar mejor los docs</li>
                            <li><strong>Hybrid search:</strong> Combinar b√∫squeda sem√°ntica + keyword (BM25) para mejor recall</li>
                            <li><strong>Memoria conversacional:</strong> Recordar contexto de conversaci√≥n (follow-up questions)</li>
                            <li><strong>A/B testing:</strong> Comparar diferentes modelos (GPT-4o-mini vs Claude Haiku) en producci√≥n</li>
                            <li><strong>Analytics:</strong> Dashboard con queries m√°s comunes, escalation rate, satisfaction scores</li>
                        </ul>
                    </div>

                    <div class="project-resources">
                        <h4>üìö Recursos</h4>
                        <ul>
                            <li><a href="https://python.langchain.com/docs/tutorials/rag/" target="_blank" rel="noopener">LangChain RAG Tutorial</a></li>
                            <li><a href="https://docs.trychroma.com/getting-started" target="_blank" rel="noopener">Chroma Quick Start</a></li>
                            <li><a href="https://cookbook.openai.com/examples/question_answering_using_embeddings" target="_blank" rel="noopener">OpenAI RAG Cookbook</a></li>
                            <li><a href="https://docs.smith.langchain.com/" target="_blank" rel="noopener">LangSmith Docs (Evaluaci√≥n)</a></li>
                        </ul>
                    </div>

                    <button class="project-toggle-btn" onclick="toggleProjectDetails('proyecto1')">
                        Ver Detalles Completos ‚Üì
                    </button>
                </div>
            </div>
        </section>

        <!-- Tab Content: Proyecto 2 -->
        <section id="proyecto2" class="tab-content projects-section">
            <h2>üìä Proyecto 2: Agente de An√°lisis de Datos</h2>

            <div class="project-card">
                <div class="project-header">
                    <div class="project-number">Proyecto 2</div>
                    <h3>üìä Agente de An√°lisis de Datos con Code Interpreter</h3>
                    <div class="project-meta">
                        <span class="difficulty advanced">Intermedia-Avanzada</span>
                        <span class="time">‚è±Ô∏è 6-8 horas</span>
                    </div>
                </div>

                <div class="project-content">
                    <div class="project-description">
                        <h4>üìã Descripci√≥n del Problema</h4>
                        <p>Un analista de negocios necesita insights r√°pidos de datos pero no sabe programar. El agente debe:</p>
                        <ul>
                            <li>Aceptar archivos CSV como input</li>
                            <li>Responder preguntas en lenguaje natural: "¬øCu√°l es el promedio de ventas por regi√≥n?"</li>
                            <li>Ejecutar c√≥digo Python (pandas, matplotlib) para an√°lisis</li>
                            <li>Generar gr√°ficos visuales autom√°ticamente</li>
                            <li>Explicar resultados en espa√±ol simple (no jerga t√©cnica)</li>
                        </ul>
                        <p><strong>Ejemplo de interacci√≥n:</strong></p>
                        <div class="example-interaction">
                            <div class="user-msg">üë§ "Analiza ventas.csv y dime qu√© regi√≥n vendi√≥ m√°s en Q4"</div>
                            <div class="agent-msg">ü§ñ Analizando datos...<br><code>[Ejecuta: df = pd.read_csv(...); df[df['quarter']=='Q4'].groupby('region')['sales'].sum()]</code><br>üìä [Genera gr√°fico de barras]<br><br>La regi√≥n Norte lider√≥ ventas en Q4 con $2.3M (35% del total). Sur fue segundo con $1.8M. Te adjunto el gr√°fico üìà</div>
                        </div>
                    </div>

                    <div class="project-architecture">
                        <h4>üèóÔ∏è Arquitectura Propuesta</h4>
                        <div class="architecture-diagram">
                            <div class="arch-flow">
                                <div class="arch-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <strong>Plan</strong>
                                        <p>LLM genera plan de an√°lisis:<br>"1. Cargar CSV<br>2. Filtrar Q4<br>3. Agrupar por regi√≥n<br>4. Sumar ventas<br>5. Graficar"</p>
                                    </div>
                                </div>
                                <div class="arch-arrow-down">‚Üì</div>
                                <div class="arch-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <strong>Execute</strong>
                                        <p>Ejecuta cada paso en sandbox:<br><code>docker run python pandas_script.py</code></p>
                                    </div>
                                </div>
                                <div class="arch-arrow-down">‚Üì</div>
                                <div class="arch-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <strong>Interpret</strong>
                                        <p>LLM lee resultados y explica:<br>"La regi√≥n Norte lider√≥..."</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="project-code">
                        <h4>üíª Pseudoc√≥digo</h4>
                        <pre><code class="language-python"># 1. Plan-and-Execute Architecture
class DataAnalysisAgent:
    def __init__(self):
        self.llm = ChatOpenAI(model="gpt-4o-mini")
        self.sandbox = DockerSandbox()
        
    def analyze(self, question, csv_path):
        # Paso 1: PLAN
        plan = self.generate_plan(question, csv_path)
        print(f"Plan: {plan}")
        
        # Paso 2: EXECUTE
        results = []
        for step in plan["steps"]:
            code = self.generate_code(step, csv_path)
            # Validar c√≥digo (no imports peligrosos)
            if not self.is_safe_code(code):
                return {"error": "C√≥digo no seguro detectado"}
            
            # Ejecutar en sandbox
            output = self.sandbox.run(code, timeout=30)
            results.append({"step": step, "output": output})
        
        # Paso 3: INTERPRET
        interpretation = self.interpret_results(question, results)
        
        return {
            "answer": interpretation["text"],
            "charts": interpretation["charts"],
            "code": [r["code"] for r in results]
        }
    
    def generate_plan(self, question, csv_path):
        # Inspeccionar CSV para dar contexto al LLM
        df_preview = pd.read_csv(csv_path, nrows=5)
        columns = df_preview.columns.tolist()
        dtypes = df_preview.dtypes.to_dict()
        
        prompt = f"""Genera un plan de an√°lisis para responder esta pregunta.
Datos: {csv_path}
Columnas: {columns}
Tipos: {dtypes}
Primeras filas: {df_preview.to_string()}

Pregunta: {question}

Devuelve un JSON con steps:
{{"steps": ["paso 1", "paso 2", ...]}}"""
        
        response = self.llm.invoke(prompt)
        return json.loads(response.content)
    
    def generate_code(self, step, csv_path):
        prompt = f"""Genera c√≥digo Python para este paso de an√°lisis.
Paso: {step}
Archivo CSV: {csv_path}

Usa pandas y matplotlib. Guarda gr√°ficos como PNG.
SOLO c√≥digo Python, sin explicaciones."""
        
        response = self.llm.invoke(prompt)
        return response.content
    
    def is_safe_code(self, code):
        # Validaciones b√°sicas
        dangerous_imports = ["os", "subprocess", "sys", "shutil"]
        dangerous_functions = ["eval", "exec", "open", "__import__"]
        
        for danger in dangerous_imports + dangerous_functions:
            if danger in code:
                return False
        return True
    
    def interpret_results(self, question, results):
        # Resultados de ejecuci√≥n
        outputs = [r["output"] for r in results]
        
        prompt = f"""Explica estos resultados en espa√±ol simple (sin jerga t√©cnica).
Pregunta original: {question}
Resultados: {outputs}

Responde como si hablaras con un analista de negocios."""
        
        response = self.llm.invoke(prompt)
        return {"text": response.content, "charts": [/* rutas a PNGs */]}

# 2. Sandbox con Docker
class DockerSandbox:
    def run(self, code, timeout=30):
        # Crear contenedor temporal
        container = docker.run(
            image="python:3.10-slim",
            command=f"python -c '{code}'",
            timeout=timeout,
            network="none",  # Sin acceso a red
            mem_limit="512m",  # L√≠mite de memoria
            cpu_quota=50000  # L√≠mite de CPU
        )
        return container.logs()

# 3. Evaluaci√≥n
def evaluate_analysis_agent(test_cases):
    agent = DataAnalysisAgent()
    results = []
    
    for question, csv_path, expected_answer in test_cases:
        result = agent.analyze(question, csv_path)
        
        # M√©tricas
        execution_success = "error" not in result
        answer_quality = llm_judge(result["answer"], expected_answer)
        
        results.append({
            "question": question,
            "success": execution_success,
            "quality_score": answer_quality
        })
    
    success_rate = sum(r["success"] for r in results) / len(results)
    avg_quality = sum(r["quality_score"] for r in results) / len(results)
    
    return {"success_rate": success_rate, "avg_quality": avg_quality}</code></pre>
                    </div>

                    <div class="project-decisions">
                        <h4>ü§î Decisiones de Dise√±o</h4>
                        <div class="decision-item">
                            <strong>¬øPor qu√© Plan-and-Execute en vez de ReAct?</strong>
                            <p>ReAct es reactivo (paso a paso). Para an√°lisis de datos, es mejor planificar TODO antes de ejecutar (m√°s eficiente, menos llamadas al LLM).</p>
                        </div>
                        <div class="decision-item">
                            <strong>¬øPor qu√© sandbox con Docker?</strong>
                            <p>Ejecutar c√≥digo no confiable es peligroso. Docker a√≠sla el c√≥digo: sin acceso a red, l√≠mites de CPU/memoria, no puede tocar el filesystem host.</p>
                        </div>
                        <div class="decision-item">
                            <strong>¬øPor qu√© validar c√≥digo antes de ejecutar?</strong>
                            <p>Defensa en profundidad. Aunque Docker a√≠sla, mejor prevenir c√≥digo malicioso (imports peligrosos como <code>os.system</code>).</p>
                        </div>
                    </div>

                    <div class="project-improvements">
                        <h4>üöÄ Mejoras Opcionales</h4>
                        <ul>
                            <li><strong>Cach√© de an√°lisis:</strong> Guardar resultados de queries repetidas</li>
                            <li><strong>Streaming:</strong> Mostrar an√°lisis en tiempo real mientras se ejecuta</li>
                            <li><strong>Soporte multi-archivo:</strong> Joins entre m√∫ltiples CSVs</li>
                            <li><strong>Exportar resultados:</strong> Descargar an√°lisis como Excel o PDF</li>
                            <li><strong>Templates:</strong> An√°lisis pre-definidos (ventas por mes, top productos, etc.)</li>
                        </ul>
                    </div>

                    <div class="project-resources">
                        <h4>üìö Recursos</h4>
                        <ul>
                            <li><a href="https://github.com/langchain-ai/langgraph/blob/main/examples/plan-and-execute/plan-and-execute.ipynb" target="_blank" rel="noopener">LangGraph Plan-and-Execute</a></li>
                            <li><a href="https://docs.docker.com/engine/api/sdk/examples/" target="_blank" rel="noopener">Docker Python SDK</a></li>
                            <li><a href="https://platform.openai.com/docs/assistants/tools/code-interpreter" target="_blank" rel="noopener">OpenAI Code Interpreter API</a></li>
                            <li><a href="https://github.com/e2b-dev/e2b" target="_blank" rel="noopener">E2B - Sandbox as a Service</a></li>
                        </ul>
                    </div>

                    <button class="project-toggle-btn" onclick="toggleProjectDetails('proyecto2')">
                        Ver Detalles Completos ‚Üì
                    </button>
                </div>
            </div>
        </section>

        <!-- Tab Content: Proyecto 3 -->
        <section id="proyecto3" class="tab-content projects-section">
            <h2>üîç Proyecto 3: Agente de Investigaci√≥n Multi-Fuente</h2>

            <!-- Proyecto 3: Research Agent -->
            <div class="project-card" id="proyecto3">
                <div class="project-header">
                    <div class="project-number">Proyecto 3</div>
                    <h3>üîç Agente de Investigaci√≥n Multi-Fuente</h3>
                    <div class="project-meta">
                        <span class="difficulty expert">Avanzada</span>
                        <span class="time">‚è±Ô∏è 10-12 horas</span>
                    </div>
                </div>

                <div class="project-content">
                    <div class="project-description">
                        <h4>üìã Descripci√≥n del Problema</h4>
                        <p>Un investigador o analista necesita un reporte sobre un tema complejo (ej: "Estado actual de IA en medicina"). El agente debe:</p>
                        <ul>
                            <li>Buscar informaci√≥n en: Google, papers cient√≠ficos (arXiv), Wikipedia, sitios espec√≠ficos</li>
                            <li>Leer y procesar 20-30 fuentes</li>
                            <li>Identificar hallazgos clave y tendencias</li>
                            <li>Fact-check: verificar claims importantes en m√∫ltiples fuentes</li>
                            <li>Generar reporte estructurado (introducci√≥n, hallazgos, conclusiones) con citas verificables</li>
                        </ul>
                        <p><strong>Output esperado:</strong> Reporte de 3-5 p√°ginas, formato markdown, con secciones claras y 15-20 citas.</p>
                    </div>

                    <div class="project-architecture">
                        <h4>üèóÔ∏è Arquitectura Propuesta (Multi-Agente)</h4>
                        <div class="multi-agent-diagram">
                            <div class="agent-node">
                                <div class="agent-icon">üîç</div>
                                <strong>Searcher Agent</strong>
                                <p>Busca fuentes relevantes<br>(Google, arXiv, Wikipedia)</p>
                            </div>
                            <div class="arrow-right">‚Üí</div>
                            <div class="agent-node">
                                <div class="agent-icon">üìñ</div>
                                <strong>Reader Agent</strong>
                                <p>Lee cada fuente y extrae hallazgos clave</p>
                            </div>
                            <div class="arrow-right">‚Üí</div>
                            <div class="agent-node">
                                <div class="agent-icon">üß†</div>
                                <strong>Synthesizer Agent</strong>
                                <p>Agrupa hallazgos por tema y sintetiza</p>
                            </div>
                            <div class="arrow-down">‚Üì</div>
                            <div class="agent-node">
                                <div class="agent-icon">‚úÖ</div>
                                <strong>Fact-Checker Agent</strong>
                                <p>Verifica claims en m√∫ltiples fuentes</p>
                            </div>
                            <div class="arrow-down">‚Üì</div>
                            <div class="agent-node">
                                <div class="agent-icon">üìù</div>
                                <strong>Writer Agent</strong>
                                <p>Genera reporte final estructurado</p>
                            </div>
                        </div>
                    </div>

                    <div class="project-code">
                        <h4>üíª Pseudoc√≥digo (Simplificado)</h4>
                        <pre><code class="language-python"># Sistema Multi-Agente
class ResearchAgent:
    def __init__(self):
        self.searcher = SearcherAgent()
        self.reader = ReaderAgent()
        self.synthesizer = SynthesizerAgent()
        self.fact_checker = FactCheckerAgent()
        self.writer = WriterAgent()
        
    def research(self, topic):
        # Paso 1: B√öSQUEDA
        sources = self.searcher.find_sources(topic, max_sources=30)
        # Output: [{"url": "...", "title": "...", "source_type": "paper"}, ...]
        
        # Paso 2: LECTURA (paralelo)
        findings = []
        with ThreadPoolExecutor(max_workers=5) as executor:
            futures = [executor.submit(self.reader.extract_findings, src) for src in sources]
            for future in futures:
                findings.extend(future.result())
        # Output: [{"finding": "...", "source": "...", "relevance": 0.9}, ...]
        
        # Paso 3: S√çNTESIS
        synthesis = self.synthesizer.group_and_synthesize(findings)
        # Output: {"themes": [{"name": "...", "findings": [...]}], "trends": [...]}
        
        # Paso 4: FACT-CHECKING
        verified_synthesis = self.fact_checker.verify(synthesis, sources)
        # Output: Synthesis + {"verified": True/False, "confidence": 0-1} para cada claim
        
        # Paso 5: ESCRITURA
        report = self.writer.generate_report(topic, verified_synthesis, sources)
        
        return report

# Agente 1: Searcher
class SearcherAgent:
    def find_sources(self, topic, max_sources=30):
        sources = []
        
        # Google Search (v√≠a API SerpAPI o similar)
        google_results = self.google_search(topic, num_results=15)
        sources.extend(google_results)
        
        # arXiv (papers cient√≠ficos)
        arxiv_results = self.arxiv_search(topic, num_results=10)
        sources.extend(arxiv_results)
        
        # Wikipedia
        wiki_result = self.wikipedia_search(topic)
        if wiki_result:
            sources.append(wiki_result)
        
        # Ranking: ordenar por relevancia (puede usar LLM o BM25)
        ranked_sources = self.rank_sources(sources, topic)
        
        return ranked_sources[:max_sources]

# Agente 2: Reader
class ReaderAgent:
    def extract_findings(self, source):
        # Scrape content
        content = self.fetch_content(source["url"])
        
        # Chunking (divide en fragmentos de 1000 tokens)
        chunks = self.chunk_text(content, chunk_size=1000)
        
        # LLM extrae hallazgos de cada chunk
        findings = []
        for chunk in chunks:
            prompt = f"""Extrae hallazgos clave sobre el tema de este texto.
Formato: lista de bullets.

Texto: {chunk}"""
            
            response = self.llm.invoke(prompt)
            findings.extend(response.content.split("\n- "))
        
        return [{"finding": f, "source": source["title"], "url": source["url"]} for f in findings]

# Agente 3: Synthesizer
class SynthesizerAgent:
    def group_and_synthesize(self, findings):
        # Embeddings de cada finding
        embeddings = [self.embed(f["finding"]) for f in findings]
        
        # Clustering (K-means, n_clusters=5)
        clusters = KMeans(n_clusters=5).fit_predict(embeddings)
        
        # Agrupar findings por cluster
        themes = {}
        for i, finding in enumerate(findings):
            cluster_id = clusters[i]
            if cluster_id not in themes:
                themes[cluster_id] = []
            themes[cluster_id].append(finding)
        
        # LLM nombra cada tema y sintetiza
        synthesis = []
        for cluster_id, cluster_findings in themes.items():
            prompt = f"""Estos hallazgos est√°n relacionados. Dales un nombre de tema y sintet√≠zalos en 2-3 oraciones.

Hallazgos:
{chr(10).join([f["finding"] for f in cluster_findings])}"""
            
            response = self.llm.invoke(prompt)
            synthesis.append({
                "theme": response.content.split("\n")[0],
                "summary": response.content,
                "findings": cluster_findings
            })
        
        return {"themes": synthesis}

# Agente 4: Fact-Checker
class FactCheckerAgent:
    def verify(self, synthesis, sources):
        # Para cada claim importante, verificar en m√∫ltiples fuentes
        for theme in synthesis["themes"]:
            claims = self.extract_claims(theme["summary"])
            for claim in claims:
                # Buscar evidencia en fuentes
                evidence_count = self.count_evidence(claim, sources)
                claim["verified"] = evidence_count >= 2  # Al menos 2 fuentes
                claim["confidence"] = min(evidence_count / 3, 1.0)
        
        return synthesis

# Agente 5: Writer
class WriterAgent:
    def generate_report(self, topic, synthesis, sources):
        prompt = f"""Genera un reporte de investigaci√≥n sobre: {topic}

Estructura:
1. Introducci√≥n (1 p√°rrafo)
2. Hallazgos (una secci√≥n por tema)
3. Conclusiones (2-3 p√°rrafos)

Usa citas: [1], [2], etc.
Incluye secci√≥n de referencias al final.

Contenido sintetizado:
{json.dumps(synthesis, indent=2)}"""
        
        response = self.llm.invoke(prompt, max_tokens=4000)
        
        # Agregar referencias
        references = self.format_references(sources)
        report = response.content + "\n\n## Referencias\n" + references
        
        return report</code></pre>
                    </div>

                    <div class="project-decisions">
                        <h4>ü§î Decisiones de Dise√±o</h4>
                        <div class="decision-item">
                            <strong>¬øPor qu√© multi-agente en vez de un solo agente?</strong>
                            <p>Cada agente se especializa en una tarea (buscar, leer, sintetizar, verificar, escribir). M√°s modular, testeable, y permite paralelizar lectura de fuentes.</p>
                        </div>
                        <div class="decision-item">
                            <strong>¬øPor qu√© clustering para agrupar findings?</strong>
                            <p>Con 100+ findings, es dif√≠cil para un humano o LLM agruparlos manualmente. Clustering autom√°tico encuentra temas emergentes.</p>
                        </div>
                        <div class="decision-item">
                            <strong>¬øPor qu√© fact-checking con m√∫ltiples fuentes?</strong>
                            <p>Un solo LLM puede alucinar. Si un claim aparece en 2-3 fuentes independientes, es m√°s cre√≠ble. Esto aumenta la confianza del reporte.</p>
                        </div>
                    </div>

                    <div class="project-improvements">
                        <h4>üöÄ Mejoras Opcionales</h4>
                        <ul>
                            <li><strong>Streaming de progreso:</strong> Mostrar qu√© fuente est√° leyendo en tiempo real</li>
                            <li><strong>Priorizaci√≥n de fuentes:</strong> Papers acad√©micos > blogs > redes sociales</li>
                            <li><strong>Gr√°ficos autom√°ticos:</strong> Timeline de eventos, redes de conceptos</li>
                            <li><strong>Multi-idioma:</strong> Buscar en ingl√©s, franc√©s, espa√±ol</li>
                            <li><strong>Actualizaci√≥n continua:</strong> Re-ejecutar b√∫squeda cada semana, detectar cambios</li>
                        </ul>
                    </div>

                    <div class="project-resources">
                        <h4>üìö Recursos</h4>
                        <ul>
                            <li><a href="https://github.com/langchain-ai/langgraph/tree/main/examples/multi_agent" target="_blank" rel="noopener">LangGraph Multi-Agent Examples</a></li>
                            <li><a href="https://serpapi.com/" target="_blank" rel="noopener">SerpAPI (Google Search)</a></li>
                            <li><a href="https://arxiv.org/help/api" target="_blank" rel="noopener">arXiv API</a></li>
                            <li><a href="https://github.com/assafelovic/gpt-researcher" target="_blank" rel="noopener">GPT Researcher (proyecto similar open source)</a></li>
                        </ul>
                    </div>

                    <button class="project-toggle-btn" onclick="toggleProjectDetails('proyecto3')">
                        Ver Detalles Completos ‚Üì
                    </button>
                </div>
            </div>
        </section>

        <!-- Tab Content: Certificado -->
        <section id="certificado" class="tab-content certificate-section">
            <h2>üéì ¬°Felicidades por Completar el Curso!</h2>
            
            <div class="certificate-container">
                <div class="certificate-info">
                    <p>Si completaste los 3 proyectos capstone, ¬°mereces reconocimiento! Genera tu certificado personalizado para compartir en LinkedIn o tu portafolio.</p>
                    
                    <div class="certificate-form">
                        <h3>Genera Tu Certificado</h3>
                        <form id="certificateForm">
                            <div class="form-group">
                                <label for="studentName">Tu Nombre Completo</label>
                                <input type="text" id="studentName" name="studentName" placeholder="Ej: Mar√≠a Garc√≠a" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Proyectos Completados</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="project1" id="project1" required> Proyecto 1: FAQ Agent</label>
                                    <label><input type="checkbox" name="project2" id="project2" required> Proyecto 2: Data Analysis Agent</label>
                                    <label><input type="checkbox" name="project3" id="project3" required> Proyecto 3: Research Agent</label>
                                </div>
                            </div>
                            
                            <button type="button" onclick="generateCertificate()" class="btn btn-primary btn-large">
                                Generar Certificado üéì
                            </button>
                        </form>
                    </div>
                </div>

                <div class="certificate-preview hidden" id="certificatePreview">
                    <div class="certificate">
                        <div class="certificate-border">
                            <div class="certificate-content">
                                <div class="certificate-header">
                                    <div class="certificate-logo">ü§ñ</div>
                                    <h1>Code Agent Arena</h1>
                                    <p class="certificate-subtitle">Certificado de Completaci√≥n</p>
                                </div>
                                
                                <div class="certificate-body">
                                    <p class="certificate-text">Se otorga este certificado a</p>
                                    <h2 class="certificate-name" id="certName">Mar√≠a Garc√≠a</h2>
                                    <p class="certificate-text">Por completar exitosamente el curso</p>
                                    <h3 class="certificate-course">"Agentes de IA: De Fundamentos a Proyectos"</h3>
                                    
                                    <div class="certificate-details">
                                        <p>‚úÖ 7 M√≥dulos Completos</p>
                                        <p>‚úÖ 15+ Juegos Interactivos</p>
                                        <p>‚úÖ 3 Proyectos Capstone</p>
                                    </div>
                                    
                                    <div class="certificate-skills">
                                        <p><strong>Habilidades Adquiridas:</strong></p>
                                        <p>Arquitecturas de Agentes ‚Ä¢ RAG ‚Ä¢ Multi-Agente ‚Ä¢ Evaluaci√≥n ‚Ä¢ Seguridad ‚Ä¢ Optimizaci√≥n</p>
                                    </div>
                                </div>
                                
                                <div class="certificate-footer">
                                    <div class="certificate-date">
                                        <p>Fecha de Completaci√≥n</p>
                                        <p id="certDate">8 de Diciembre, 2025</p>
                                    </div>
                                    <div class="certificate-signature">
                                        <p>Yamid Cueto</p>
                                        <p>Instructor</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="certificate-actions">
                        <button onclick="downloadCertificate()" class="btn btn-primary">Descargar PNG üì•</button>
                        <button onclick="shareCertificate()" class="btn btn-secondary">Compartir en LinkedIn üîó</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Navigation -->
        <section class="module-navigation">
            <a href="module6.html" class="nav-btn nav-prev">‚Üê M√≥dulo 6</a>
            <a href="../index.html" class="nav-btn nav-next">Volver al Inicio üè†</a>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>ü§ñ Code Agent Arena - M√≥dulo 7: Proyectos Capstone</p>
            <p>Hecho con ‚ù§Ô∏è por <a href="https://github.com/YamiCueto" target="_blank" rel="noopener">Yamid Cueto</a> para la comunidad</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script src="../js/quiz-system.js"></script>
    <script src="../js/games/capstone-projects.js"></script>
</body>
</html>
